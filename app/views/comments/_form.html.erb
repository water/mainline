<%
%>

<% comment ||= nil -%>
<% sha1 ||= nil -%>
<% parent ||= nil -%>
<div id="comment-form">
<h3><%= t("views.comments.add_title") %>:</h3>

<% if logged_in? -%>
  <%= error_messages_for :comment -%>
  <%= form_for(:comment, :url => new_polymorphic_comment_path(parent, comment || Comment.new)) do |f| -%>
    <% if sha1 -%>
      <%= f.hidden_field :sha1, :value => sha1 -%>
    <% end -%>
    <p>
      <%= f.label :body, t("views.comments.body") -%>
      <span class="hint">
        (<%= markdown_hint -%>)
      </span><br />
      <%= f.text_area :body, :class => "text medium" -%><br />
    </p>
    <p class="hint markdown_help_link"><small>
      <a href="#markdown-help" class="markdown-help-toggler">Toggle Markdown help</a>
    </small></p>
    <%= render_markdown_help %>
    <div id="comment_preview">
      
    </div>
    <p>
      <input type="button" class="preview" value="Preview" id="comment_preview_button" />
      <%- if MergeRequest === parent && (logged_in? &&
      parent.resolvable_by?(current_user)) -%>
        <%= f.submit t("views.comments.update_or_add") -%>
      <% else -%>
        <%= f.submit t("views.comments.add") -%>
      <% end -%>
    </p>
  <% end -%>
<% else -%>
  <p>
    <em><%= link_to t("views.sessions.login"), new_sessions_path -%> or 
    <%= link_to t("views.users.create"), new_user_path -%> to post a comment</em>
  </p>
<% end -%>
</div>
