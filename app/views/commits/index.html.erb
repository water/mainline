<%
%>

<% @page_title = t("views.logs.title", :repo_url => h(@repository.url_path), :ref => h(@ref)) -%>
<%= breadcrumbs_from(@root) -%>

<ul class="horizontal meta" style="float:right">
  <li class="tree">
    <%= link_to "Source tree", repo_owner_path(@repository, :project_repository_tree_path,
          @project, @repository, desplat_path(params[:branch])) -%>
  </li>
</ul>
<h1>
  <%= t("views.logs.title", :repo_url => h(@repository.url_path), :ref => h(@ref)) -%>
</h1>

<div class="commit_graph">
  <%= commit_graph_tag(@repository) %>
</div>

<% cache([repo_owner_path(@repository, [@project, @repository]), :commits, @ref, @commits.current_page], {:expires_in => 10.minutes}) do -%>
  <%= render :partial => "log" -%>
<% end -%>

<% content_for :sidebar do -%>
  <ul class="sidebar-meta">
    <li>
      <strong><%= t("views.logs.project") %>:</strong> 
      <%= link_to h(@repository.project.title), @repository.project -%>
    </li>
    <li>
      <strong><%= t("views.repos.owner") %>:</strong> 
      <%= link_to h(@repository.owner.to_param_with_prefix), @repository.owner -%>
    </li>
    <% unless @commits.blank? -%>
    <li>
      <strong><%= t("views.logs.head_tree") %>:</strong> 
      <%= link_to h(@commits.first.tree.id[0,7]), tree_path(branch_with_tree(@commits.first.id, [])) -%>
    </li>
    <% end -%>
  </ul>
  
  <ul class="links navigation">
    <%= render_download_links(@project, @repository, params[:branch], :only_list_items => true) %>
  </ul>

<% cache([repo_owner_path(@repository, [@project, @repository]), :tags_and_branches], 
        {:expires_in => 10.minutes}) do -%>
 
  <ul class="icon_list links navigation">
	 <h5 id="branches"><%= t("views.logs.branches") %>:</h5>
    <%= render_branch_list_items(@git.branches) -%>
  </ul>

  <% unless @git.tags.blank? -%>
  <ul class="icon_list links navigation">
	<h5 id="tags"><%= t("views.logs.tags") %>:</h5>
  <% @git.tags.sort{|a, b| a.name <=> b.name }.each do |tag| -%>
    <li><%= link_to h(tag.name), commit_path(tag.commit.id) -%></li>
  <% end -%>
  </ul>
  <% end -%>
  
  <%= commit_graph_by_author_tag(@repository, params[:id]) %>
<% end -%>
<% end -%>
